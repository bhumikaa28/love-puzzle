<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Love Puzzle ❤️</title>
  <style>
    /* --- Page Styling --- */
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #b76e79; /* Rusted pink background */
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    /* --- Puzzle Container --- */
    #puzzle {
      width: 320px;
      height: 320px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 2px;
    }

    /* --- Puzzle Pieces --- */
    .piece {
      width: 80px;
      height: 80px;
      background-image: url("photo.jpg");
      background-size: 320px 320px;
      cursor: pointer;
      transition: outline 0.2s;
    }

    /* --- Heart Styles --- */
    .heart {
      position: fixed;
      top: -50px;
      color: #e91e63;
      z-index: 9999;
      animation-name: fall;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
    }

    @keyframes fall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(110vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div id="puzzle"></div>
  <audio id="loveMusic" src="music.mp3"></audio>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const puzzle = document.getElementById("puzzle");
      const positions = [];
      let first = null;
      let solvedOnce = false;

      // --- Create shuffled puzzle positions ---
      for (let i = 0; i < 16; i++) positions.push(i);
      positions.sort(() => Math.random() - 0.5);

      // --- Create puzzle pieces ---
      positions.forEach((pos) => {
        const piece = document.createElement("div");
        piece.className = "piece";
        piece.style.backgroundPosition =
          `${-(pos % 4) * 80}px ${-Math.floor(pos / 4) * 80}px`;
        piece.dataset.current = pos;
        piece.addEventListener("click", () => swap(piece));
        puzzle.appendChild(piece);
      });

      // --- Swap pieces on click ---
      function swap(piece) {
        if (!first) {
          first = piece;
          piece.style.outline = "2px solid #e91e63";
        } else {
          const temp = first.style.backgroundPosition;
          first.style.backgroundPosition = piece.style.backgroundPosition;
          piece.style.backgroundPosition = temp;

          const tempData = first.dataset.current;
          first.dataset.current = piece.dataset.current;
          piece.dataset.current = tempData;

          first.style.outline = "none";
          first = null;

          checkSolved();
        }
      }

      // --- Check if puzzle is solved ---
      function checkSolved() {
        const pieces = document.querySelectorAll(".piece");
        let solved = true;

        pieces.forEach((p, i) => {
          if (p.dataset.current != i) solved = false;
        });

        if (solved && !solvedOnce) {
          solvedOnce = true;

          // Play music
          const music = document.getElementById("loveMusic");
          music.volume = 0.6;
          music.play();

          // Launch hearts
          launchHearts();

          // Show message
          setTimeout(() => {
            alert("Hi sweetheart, I love you sooooo much. You mean the world to me. I cannot imagine my life without you. Do you promise to stay with me forever?");
          }, 300);
        }
      }

      // --- Launch continuous hearts ---
      function launchHearts() {
        const totalHearts = 200;
        const durationMin = 4;
        const durationMax = 8;
        const sizeMin = 15;
        const sizeMax = 35;

        for (let i = 0; i < totalHearts; i++) {
          const heart = document.createElement("div");
          heart.className = "heart";
          heart.innerText = "❤️";

          heart.style.left = Math.random() * 100 + "vw";
          heart.style.fontSize = (sizeMin + Math.random() * (sizeMax - sizeMin)) + "px";
          heart.style.animationDuration = (durationMin + Math.random() * (durationMax - durationMin)) + "s";
          heart.style.animationDelay = Math.random() * 2 + "s";
          heart.style.transform = `rotate(${Math.random() * 360}deg)`;

          document.body.appendChild(heart);
          setTimeout(() => heart.remove(), (durationMax + 2) * 1000);
        }

        // Repeat every 2 seconds
        setTimeout(() => launchHearts(), 2000);
      }
    });
  </script>
</body>
</html>
